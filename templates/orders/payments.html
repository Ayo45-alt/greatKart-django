{% extends 'base.html' %} 
{% load static humanize %}

{% block content %}
<section class="section-content padding-y bg">
  <div class="container">
    <h4 class="text-center mb-4">Review Your Order and Make Payment</h4>

    <div class="row">
      <!-- LEFT SIDE -->
      <aside class="col-lg-8">
        <!-- Billing Address -->
        <div class="card mb-3 shadow-sm">
          <h5 class="card-header bg-light">Billing Address</h5>
          <div class="card-body">
            <p class="mb-1 fw-semibold">{{ order.first_name }} {{ order.last_name }}</p>
            <p class="mb-1 text-muted"><small>Username:</small> {{ order.user.username }}</p>
            <p class="mb-1">{{ order.address_line_1 }}</p>
            {% if order.address_line_2 %}
              <p class="mb-1">{{ order.address_line_2 }}</p>
            {% endif %}
            <p class="mb-1">{{ order.city }}, {{ order.state }}</p>
            <p class="mb-1">{{ order.country }}</p>
            <p class="mb-1">{{ order.email }}</p>
            <p class="mb-1">{{ order.phone }}</p>
            {% if order.order_note %}
              <p class="mt-2"><strong>Order Note:</strong> {{ order.order_note }}</p>
            {% endif %}
          </div>
        </div>

        <!-- Review Products -->
        <div class="card shadow-sm">
          <h5 class="card-header bg-light">Review Products</h5>
          <div class="card-body">
            <table class="table table-borderless align-middle">
              <thead>
                <tr>
                  <th>PRODUCT</th>
                  <th class="text-center">QUANTITY</th>
                  <th class="text-end">PRICE</th>
                </tr>
              </thead>
              <tbody>
                {% for cart_item in cart_items %}
                <tr>
                  <td>
                    <div class="d-flex align-items-center">
                      <img src="{{ cart_item.product.images.url }}" width="60" height="60" class="rounded me-2 border">
                      <div>
                        <strong>{{ cart_item.product.product_name }}</strong><br>
                        <small class="text-muted">
                          Color: {{ cart_item.variation_set.first.color|default:"-" }}<br>
                          Size: {{ cart_item.variation_set.first.size|default:"-" }}
                        </small>
                      </div>
                    </div>
                  </td>
                  <td class="text-center">{{ cart_item.quantity }}</td>
                  <td class="text-end">
                    ₦{{ cart_item.sub_total|floatformat:2|intcomma }}<br>
                    <small class="text-muted">₦{{ cart_item.product.price|floatformat:2|intcomma }} each</small>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Payment Button -->
        <div class="card mt-3 shadow-sm">
          <h5 class="card-header bg-light">Payment Method</h5>
          <div class="card-body">
            <p class="mb-3">Simulated Payment (₦{{ grand_total|floatformat:2|intcomma }})</p>
            <form action="{% url 'payments' %}" method="POST">
              {% csrf_token %}
              <button type="submit" class="btn btn-primary w-100">Simulate Payment</button>
            </form>
          </div>
        </div>
      </aside>

      <!-- RIGHT SIDE -->
      <aside class="col-lg-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-3">Order Summary</h5>
            <dl class="dlist-align">
              <dt>Total price:</dt>
              <dd class="text-end">₦{{ total|floatformat:2|intcomma }}</dd>
            </dl>
            <dl class="dlist-align">
              <dt>Tax:</dt>
              <dd class="text-end">₦{{ tax|floatformat:2|intcomma }}</dd>
            </dl>
            <dl class="dlist-align border-top pt-2">
              <dt><strong>Grand Total:</strong></dt>
              <dd class="text-end"><strong>₦{{ grand_total|floatformat:2|intcomma }}</strong></dd>
            </dl>
          </div>
        </div>
      </aside>
    </div>
  </div>
</section>
{% endblock %}
